<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>QUnit Tests</title>
    <link rel="stylesheet" href="https://code.jquery.com/qunit/qunit-2.1.1.css">
    <script type="text/javascript" src="../scripts/block.js"></script>
    <script type="text/javascript" src="../scripts/cell.js"></script>
    <script type="text/javascript" src="../scripts/collage.js"></script>
</head>
<body>
    <div id="qunit"></div>
    <div id="qunit-fixture"></div>
    <script src="https://code.jquery.com/qunit/qunit-2.1.1.js"></script>
    <script>

        QUnit.module("Block", function () {
            QUnit.test("Scale to Width Tests", function (assert) {

                var block = new Block(200, 200);

                block.scaleToWidth(100);

                assert.equal(block.renderWidth, 100);
                assert.equal(block.renderHeight, 100);

                block = new Block(100, 200);

                block.scaleToWidth(50);

                assert.equal(block.renderWidth, 50);
                assert.equal(block.renderHeight, 25);
            });

            QUnit.test("Scale to Height Tests", function (assert) {

                var block = new Block(200, 200);

                block.scaleToHeight(100);

                assert.equal(block.renderWidth, 100);
                assert.equal(block.renderHeight, 100);

                block = new Block(100, 200);

                block.scaleToHeight(50);

                assert.equal(block.renderHeight, 50);
                assert.equal(block.renderWidth, 100);

            });
        });

        QUnit.module("Cell", function () {
            QUnit.test("Left Edge Calculation", function (assert) {

                assert.equal(new Cell(0, 0, 100, 100).getLeftEdge(), 0);
                assert.equal(new Cell(1, 1, 100, 100).getLeftEdge(), 100);
                assert.equal(new Cell(10, 10, 100, 100).getLeftEdge(), 1000);
            });

            QUnit.test("Right Edge Calculation", function (assert) {

                assert.equal(new Cell(0, 0, 100, 100).getRightEdge(), 100);
                assert.equal(new Cell(1, 1, 100, 100).getRightEdge(), 200);
                assert.equal(new Cell(10, 10, 100, 100).getRightEdge(), 1100);
            });

            QUnit.test("Top Edge Calculation", function (assert) {

                assert.equal(new Cell(0, 0, 100, 100).getTopEdge(), 0);
                assert.equal(new Cell(1, 1, 100, 100).getTopEdge(), 100);
                assert.equal(new Cell(10, 10, 100, 100).getTopEdge(), 1000);
            });

            QUnit.test("Bottom Edge Calculation", function (assert) {

                assert.equal(new Cell(0, 0, 100, 100).getBottomEdge(), 100);
                assert.equal(new Cell(1, 1, 100, 100).getBottomEdge(), 200);
                assert.equal(new Cell(10, 10, 100, 100).getBottomEdge(), 1100);
            });

        });

        QUnit.module("Collage", function () {

            QUnit.test("Get Column for XCoordinate Tests", function (assert) {

                var collage = new Collage(100, 100);

                assert.equal(collage.getColumnIndex(0), 0);
                assert.equal(collage.getColumnIndex(10), 1);
                assert.equal(collage.getColumnIndex(20), 2);
                assert.equal(collage.getColumnIndex(90), 9);
            });

            QUnit.test("Get Row for YCoordinate Tests", function (assert) {

                var collage = new Collage(100, 100, 20, 20);

                assert.equal(collage.getRowIndex(0), 0);
                assert.equal(collage.getRowIndex(20), 1);
                assert.equal(collage.getRowIndex(80), 4);

            });

            QUnit.test("Get Edge Type - One Edge", function (assert) {

                var collage = new Collage(100, 100, 10, 10);

                assert.deepEqual(collage.getEdgeType(collage.arr[0][3]), ["top"]);
                assert.deepEqual(collage.getEdgeType(collage.arr[0][8]), ["top"]);

                assert.deepEqual(collage.getEdgeType(collage.arr[3][0]), ["left"]);
                assert.deepEqual(collage.getEdgeType(collage.arr[8][0]), ["left"]);

                assert.deepEqual(collage.getEdgeType(collage.arr[3][9]), ["right"]);
                assert.deepEqual(collage.getEdgeType(collage.arr[8][9]), ["right"]);

                assert.deepEqual(collage.getEdgeType(collage.arr[9][3]), ["bottom"]);
                assert.deepEqual(collage.getEdgeType(collage.arr[9][8]), ["bottom"]);

                assert.deepEqual(collage.getEdgeType(collage.arr[4][4]), []);                
            });

            QUnit.test("Get Edge Type - Two Edges", function (assert) {
                var collage = new Collage(100, 100, 10, 10);

                assert.deepEqual(collage.getEdgeType(collage.arr[0][0]), ["top", "left"]);
                assert.deepEqual(collage.getEdgeType(collage.arr[0][9]), ["top", "right"]);
                assert.deepEqual(collage.getEdgeType(collage.arr[9][0]), ["bottom", "left"]);
                assert.deepEqual(collage.getEdgeType(collage.arr[9][9]), ["bottom", "right"]);
            });

            QUnit.test("Get Edge Cells", function (assert) {
                var collage = new Collage(40, 40, 10, 10);

                /*
                *   O X X O
                *   X O O X
                *   X O O X
                *   O X X O
                * X - Edge Cells
                */

                var edgeCells = collage.getEdgeCells();

                assert.deepEqual(edgeCells,
                    [collage.arr[0][1], collage.arr[0][2],
                        collage.arr[1][0], collage.arr[1][3],
                        collage.arr[2][0], collage.arr[2][3],
                        collage.arr[3][1], collage.arr[3][2]]);
                
            });


            QUnit.test("Grid Size", function (assert) {

                var collage = new Collage(100, 200);

                assert.equal(collage.arr.length, 10);
                assert.equal(collage.arr[0].length, 20);

                var collage = new Collage(200, 100);

                assert.equal(collage.arr.length, 20);
                assert.equal(collage.arr[0].length, 10);
            });

            /*QUnit.test("Empty Grid / Uneven Width Tests", function (assert) {
                //What happens if the width is 255 and we only expect column widths of 10px
            });*/

            QUnit.test("FitCorners Tests - 100x100 Block Four Corners", function (assert) {
                var collage = new Collage(800, 800);
                var blocks = [
                    new Block(100, 100),
                    new Block(100, 100),
                    new Block(100, 100),
                    new Block(100, 100)
                ];

                collage.fitCorners(blocks);

                assert.equal(blocks[0].startX, 0);
                assert.equal(blocks[0].startY, 0);

                assert.equal(blocks[1].startX, 700);
                assert.equal(blocks[1].startY, 0);

                assert.equal(blocks[2].startX, 0);
                assert.equal(blocks[2].startY, 700);

                assert.equal(blocks[3].startX, 700);
                assert.equal(blocks[3].startY, 700);
            });

            QUnit.test("FitCorners Tests - Rectangle Blocks Four Corners", function (assert) {

                var collage = new Collage(800, 800);
                var blocks = [
                    new Block(200, 100),
                    new Block(200, 200),
                    new Block(100, 200),
                    new Block(200, 200)                    
                ];

                collage.fitCorners(blocks);

                assert.equal(blocks[0].startX, 0);
                assert.equal(blocks[0].startY, 0);

                assert.equal(blocks[1].startX, 600);
                assert.equal(blocks[1].startY, 0);

                assert.equal(blocks[2].startX, 0);
                assert.equal(blocks[2].startY, 700);

                assert.equal(blocks[3].startX, 600);
                assert.equal(blocks[3].startY, 600);
            });

            QUnit.test("FitEdges Test - Perfect Fits", function (assert) {

                var collage = new Collage(40, 40, 10, 10);                
                var blocks = [
                    new Block(20, 20),                    //O X X O
                    new Block(10, 10), new Block(10, 10), //X X X X                                      
                    new Block(10, 10), new Block(10, 10), //X O O X                          
                    new Block(10, 10), new Block(10, 10), //O X X O
                    new Block(10, 10)
                ];

                collage.fitEdges(blocks, 0);

                assert.equal(blocks[0].startX, collage.arr[0][1].getLeftEdge());
                assert.equal(blocks[0].startY, collage.arr[0][1].getTopEdge());
                
                assert.equal(blocks[1].startX, collage.arr[1][0].getLeftEdge());
                assert.equal(blocks[1].startY, collage.arr[1][0].getTopEdge());
                assert.equal(blocks[2].startX, collage.arr[1][3].getLeftEdge());
                assert.equal(blocks[2].startY, collage.arr[1][3].getTopEdge());

                assert.equal(blocks[3].startX, collage.arr[2][0].getLeftEdge());
                assert.equal(blocks[3].startY, collage.arr[2][0].getTopEdge());
                assert.equal(blocks[4].startX, collage.arr[2][3].getLeftEdge());
                assert.equal(blocks[4].startY, collage.arr[2][3].getTopEdge());

                assert.equal(blocks[5].startX, collage.arr[3][1].getLeftEdge());
                assert.equal(blocks[5].startY, collage.arr[3][1].getTopEdge());
                assert.equal(blocks[6].startX, collage.arr[3][2].getLeftEdge());
                assert.equal(blocks[6].startY, collage.arr[3][2].getTopEdge());
                
                assert.equal(blocks[7].startX, undefined);
                assert.equal(blocks[7].startY, undefined);
            });

            QUnit.test("FitEdges Test - Big Right Edges", function (assert) {
                var collage = new Collage(40, 40, 10, 10);
                var blocks = [
                      new Block(10, 10), new Block(10, 10),       // O X X O
                      new Block(10, 10), new Block(20, 20),       // X O X X
                      new Block(10, 10),                          // X O X X
                      new Block(10, 10), new Block(10, 10)        // O X X O
                ];

                collage.fitEdges(blocks, 0);

                assert.equal(blocks[0].startX, collage.arr[0][1].getLeftEdge());
                assert.equal(blocks[0].startY, collage.arr[0][1].getTopEdge());
                assert.equal(blocks[1].startX, collage.arr[0][2].getLeftEdge());
                assert.equal(blocks[1].startY, collage.arr[0][2].getTopEdge());

                assert.equal(blocks[2].startX, collage.arr[1][0].getLeftEdge());
                assert.equal(blocks[2].startY, collage.arr[1][0].getTopEdge());
                assert.equal(blocks[3].startX, collage.arr[1][2].getLeftEdge());
                assert.equal(blocks[3].startY, collage.arr[1][2].getTopEdge());

                assert.equal(blocks[4].startX, collage.arr[2][0].getLeftEdge());
                assert.equal(blocks[4].startY, collage.arr[2][0].getTopEdge());

                assert.equal(blocks[5].startX, collage.arr[3][1].getLeftEdge());
                assert.equal(blocks[5].startY, collage.arr[3][1].getTopEdge());
                assert.equal(blocks[6].startX, collage.arr[3][2].getLeftEdge());
                assert.equal(blocks[6].startY, collage.arr[3][2].getTopEdge());
            });

            QUnit.test("FitEdges Test - Big Bottom Edges", function (assert) {
                var collage = new Collage(40, 40, 10, 10);
                var blocks = [
                      new Block(10, 10), new Block(10, 10),       // O X X O
                      new Block(10, 10), new Block(10, 10),       // X O O X
                      new Block(10, 10), new Block(10, 10),       // X X X X
                      new Block(20, 20),                          // O X X O
                ];

                collage.fitEdges(blocks, 0);

                assert.equal(blocks[0].startX, collage.arr[0][1].getLeftEdge());
                assert.equal(blocks[0].startY, collage.arr[0][1].getTopEdge());
                assert.equal(blocks[1].startX, collage.arr[0][2].getLeftEdge());
                assert.equal(blocks[1].startY, collage.arr[0][2].getTopEdge());

                assert.equal(blocks[2].startX, collage.arr[1][0].getLeftEdge());
                assert.equal(blocks[2].startY, collage.arr[1][0].getTopEdge());
                assert.equal(blocks[3].startX, collage.arr[1][3].getLeftEdge());
                assert.equal(blocks[3].startY, collage.arr[1][3].getTopEdge());

                assert.equal(blocks[4].startX, collage.arr[2][0].getLeftEdge());
                assert.equal(blocks[4].startY, collage.arr[2][0].getTopEdge());
                assert.equal(blocks[5].startX, collage.arr[2][3].getLeftEdge());
                assert.equal(blocks[5].startY, collage.arr[2][3].getTopEdge());

                assert.equal(blocks[6].startX, collage.arr[2][1].getLeftEdge());
                assert.equal(blocks[6].startY, collage.arr[2][1].getTopEdge());
            });

            QUnit.test("Block Adjacent Cell Tests", function (assert) {

                var collage = new Collage(100, 100, 10, 10);
                var block = new Block(20, 20);                

                // Top Left 20x20
                collage.blockAdjacentCells(block, collage.arr[0][0]);

                assert.equal(collage.arr[0][0].isAvailable, false);
                assert.equal(collage.arr[0][1].isAvailable, false);
                assert.equal(collage.arr[1][0].isAvailable, false);
                assert.equal(collage.arr[1][1].isAvailable, false);


                collage = new Collage(100, 100, 10, 10);
                block = new Block(10, 10);

                // Top Right 10x10
                collage.blockAdjacentCells(block, collage.arr[0][8]);

                assert.equal(collage.arr[0][8].isAvailable, false);
                assert.equal(collage.arr[0][9].isAvailable, true);
                assert.equal(collage.arr[1][8].isAvailable, true);
                assert.equal(collage.arr[1][9].isAvailable, true);

                // Top Right 30x10
                collage = new Collage(100, 100, 10, 10);
                block = new Block(10, 30);
                collage.blockAdjacentCells(block, collage.arr[7][0]);

                assert.equal(collage.arr[7][0].isAvailable, false);
                assert.equal(collage.arr[7][1].isAvailable, false);
                assert.equal(collage.arr[7][2].isAvailable, false);



                // Bottom Right
                collage = new Collage(100, 100, 10, 10);
                block = new Block(40, 10);
                collage.blockAdjacentCells(block, collage.arr[0][6]);

                assert.equal(collage.arr[0][6].isAvailable, false);
                assert.equal(collage.arr[1][6].isAvailable, false);
                assert.equal(collage.arr[2][6].isAvailable, false);
                assert.equal(collage.arr[3][6].isAvailable, false);
            });


        });


        QUnit.module("Collage Fit Tests", function () {

            QUnit.test("Exact Fit", function (assert) {

                var collage = new Collage(100, 100, 10, 10);
                var block = new Block(20, 20);

                collage.arr[0][2].isAvailable = false;
                collage.arr[1][2].isAvailable = false;
                collage.arr[2][0].isAvailable = false;
                collage.arr[2][1].isAvailable = false;
                
                assert.equal(collage.makeBlockFit(block, collage.arr[0][0]), true);                
                assert.equal(block.renderHeight, 20);
                assert.equal(block.renderWidth, 20);
            });
            
            QUnit.test("Too Wide (Square) - Should Resize", function (assert) {

                var collage = new Collage(100, 100, 10, 10);
                var block = new Block(30, 30);

                collage.arr[0][2].isAvailable = false;
                                
                assert.equal(collage.makeBlockFit(block, collage.arr[0][0]), true);
                assert.equal(block.renderHeight, 20);
                assert.equal(block.renderWidth, 20);
            });

            QUnit.test("Too Wide (Portrait)- Should Resize", function (assert) {

                var collage = new Collage(100, 100, 10, 10);
                var block = new Block(40, 20);

                collage.arr[0][1].isAvailable = false;

                assert.equal(collage.makeBlockFit(block, collage.arr[0][0]), true);
                assert.equal(block.renderHeight, 20);
                assert.equal(block.renderWidth, 10);
            });

            QUnit.test("Too Wide (Landscape)- Should Resize", function (assert) {

                var collage = new Collage(100, 100, 10, 10);
                var block = new Block(20, 40);

                collage.arr[0][2].isAvailable = false;

                assert.equal(collage.makeBlockFit(block, collage.arr[0][0]), true);
                assert.equal(block.renderHeight, 10);
                assert.equal(block.renderWidth, 20);
            });

            QUnit.test("Too Tall (Exact) - Should Resize", function (assert) {
                var collage = new Collage(100, 100, 10, 10);
                var block = new Block(30, 30);
                
                collage.arr[2][0].isAvailable = false;                

                assert.equal(collage.makeBlockFit(block,collage.arr[0][0]), true);
                assert.equal(block.renderHeight, 20);
                assert.equal(block.renderWidth, 20);
            });

            QUnit.test("Too Tall (Portrait) - Should Resize", function (assert) {
                var collage = new Collage(100, 100, 10, 10);
                var block = new Block(40, 20);

                collage.arr[2][0].isAvailable = false;

                assert.equal(collage.makeBlockFit(block, collage.arr[0][0]), true);
                assert.equal(block.renderHeight, 20);
                assert.equal(block.renderWidth, 10);
            });

            QUnit.test("Too Tall (Landscape) - Should Resize", function (assert) {
                var collage = new Collage(100, 100, 10, 10);
                var block = new Block(20, 40);

                collage.arr[1][0].isAvailable = false;

                assert.equal(collage.makeBlockFit(block, collage.arr[0][0]), true);
                assert.equal(block.renderHeight, 10);
                assert.equal(block.renderWidth, 20);
            });

            QUnit.test("Too Wide (Exact - Multiple Conflicts) - Should Resize", function (assert) {
                var collage = new Collage(100, 100, 10, 10);
                var block = new Block(50, 50);

                collage.arr[0][4].isAvailable = false;
                collage.arr[3][3].isAvailable = false;
                collage.arr[4][0].isAvailable = false;


                assert.equal(collage.makeBlockFit(block, collage.arr[0][0]), true);
                assert.equal(block.renderHeight, 30);
                assert.equal(block.renderWidth, 30);
            });

            QUnit.test("Cannot Fit", function (assert) {
                var collage = new Collage(100, 100, 10, 10);
                var block = new Block(50, 50);

                collage.arr[0][0].isAvailable = false;
                
                assert.equal(collage.makeBlockFit(block, collage.arr[0][0]), false);
            })


            QUnit.test("Too Big - Doesn't Fill Whole Cell - Scale Down", function (assert) {

                var collage = new Collage(100, 100, 10, 10);
                var block = new Block(25, 25);

                collage.arr[0][2].isAvailable = false;
                collage.arr[1][2].isAvailable = false;
                collage.arr[2][0].isAvailable = false;
                collage.arr[2][1].isAvailable = false;

                assert.equal(collage.makeBlockFit(block, collage.arr[0][0]), true);
                assert.equal(block.renderHeight, 20);
                assert.equal(block.renderWidth, 20);
            });

            QUnit.test("No Conflicts - Doesn't Fill Whole Cell - Scale Down", function (assert) {

                var collage = new Collage(100, 100, 10, 10);
                var block = new Block(35, 35);                

                assert.equal(collage.makeBlockFit(block, collage.arr[0][0]), true);
                assert.equal(block.renderHeight, 30);
                assert.equal(block.renderWidth, 30);
            });

            QUnit.test("No Conflicts - Doesn't Fill One Cell - Scale Down", function (assert) {

                var collage = new Collage(100, 100, 10, 10);
                var block = new Block(5, 5);

                assert.equal(collage.makeBlockFit(block, collage.arr[0][0]), false);                
            });

            QUnit.test("No Conflicts - Doesn't Fill One Cell - Scale Down", function (assert) {

                var collage = new Collage(100, 100, 10, 10);
                var block = new Block(5, 10);

                assert.equal(collage.makeBlockFit(block, collage.arr[0][0]), false);                
            });

        });

    </script>
</body>
</html>